<!DOCTYPE HTML>
<html>
    <head>
        <title>Pigeon Services</title>
        <link rel="icon" type="image/x-icon" href="pearto.webp">
        <style>
            body {
                background-color: #36393e;
            }
            p {
                color: white;
            }
        </style>
    </head>
  

    <body>
        <h1 style="font:serif;color:white;" name="title">Pigeon Services</h1>
        <p> </p>
        <p> </p>
        <p> </p>
        <p> </p>
        <p> </p>
        <p> </p>
        <p> </p>
        <p> </p>
        <p> </p>
        <p> </p>
        

    <input type="text" id="dataInput" style="width:500px" enterkeyhint="send" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"> </input>

       <script>
            async function SubmitHandle() {
                const dataInput = document.getElementById("dataInput");
                if (!dataInput) {
                    console.error("Input element 'dataInput' not found.");
                    return;
                }

                const value = dataInput.value;

                try {


                    const response = await fetch("/submit", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ data: value })
                    });
                    const text = await response.text();
                    
                    console.log(value);

                    document.getElementById('dataInput').value = ''; // Clear the input after successful submission

                } catch (err) {
                    console.error("Fetch failed:", err);
                }
            }

            const dataInput = document.getElementById("dataInput");
            if (dataInput) {
            dataInput.addEventListener("keydown", function(event) {
                // Check if the pressed key is 'Enter'
                if (event.key === "Enter") {
                    event.preventDefault(); // Prevent the default action (e.g., new line in some text areas)
                    SubmitHandle(); // Invoke the submit function
                }
            });
        }



        
        function doSomething() {
            console.log("Function was invoked from ESP32!");
            // You can put any JS logic here (update UI, fetch data, etc)
        }

        const socket = new WebSocket("ws://" + location.hostname + ":81/");

        socket.onopen = function() {
            console.log("WebSocket connected!");
        };

        socket.onerror = function(error) {
            console.error("WebSocket Error:", error);
        };

        socket.onclose = function() {
            console.warn("WebSocket connection closed");
        };

        socket.onmessage = function(event) {
            const msg = event.data;
            console.log("WS Message:", msg);
            if (msg === "CALL:doSomething") {
                doSomething();
            }
        };

    </script>

    <noscript> 
        <h1> <b>USE JAVASCRIPT GODDAMMIT! </b></h1>
    </noscript>
        
    </body>
</html> 
